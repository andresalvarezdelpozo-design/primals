<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PRIMALS</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700;800&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Rajdhani', sans-serif;
            background: #0a0a0f;
            overflow: hidden;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .game-container {
            width: 100%;
            max-width: 414px;
            height: 100vh;
            max-height: 896px;
            position: relative;
            overflow: hidden;
            background: #0a0a0f;
        }

        /* Fondo din√°mico */
        .sky {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 35%;
            transition: all 1s ease;
        }

        .sky.day {
            background: linear-gradient(180deg, #1a237e 0%, #3949ab 30%, #4fc3f7 70%, #81d4fa 100%);
        }

        .sky.sunset {
            background: linear-gradient(180deg, #311b92 0%, #7b1fa2 20%, #ff6f00 50%, #ff9800 80%, #ffcc80 100%);
        }

        .sky.night {
            background: linear-gradient(180deg, #000000 0%, #1a0b2e 40%, #2d1b69 100%);
        }

        .celestial-body {
            position: absolute;
            border-radius: 50%;
            transition: all 1s ease;
        }

        .sun {
            width: 45px;
            height: 45px;
            background: radial-gradient(circle, #ffd700 0%, #ff8c00 70%);
            box-shadow: 0 0 50px #ff8c00, 0 0 80px rgba(255,140,0,0.5);
            top: 15%;
            right: 12%;
        }

        .moon {
            width: 40px;
            height: 40px;
            background: radial-gradient(circle at 30% 30%, #e0e0e0 0%, #9e9e9e 100%);
            box-shadow: 0 0 40px rgba(224,224,224,0.5);
            top: 12%;
            right: 15%;
        }

        .moon::after {
            content: '';
            position: absolute;
            width: 35px;
            height: 35px;
            background: inherit;
            border-radius: 50%;
            top: -5px;
            left: 8px;
            filter: brightness(0.8);
        }

        .stars {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 1s;
        }

        .sky.night .stars {
            opacity: 1;
        }

        .star {
            position: absolute;
            width: 2px;
            height: 2px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 0 4px white;
            animation: twinkle 3s ease-in-out infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        .aurora {
            position: absolute;
            top: 30%;
            left: -100%;
            width: 300%;
            height: 40%;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(0,255,136,0.1) 20%,
                rgba(0,212,255,0.2) 40%,
                rgba(0,255,136,0.1) 60%,
                transparent 100%);
            filter: blur(30px);
            opacity: 0;
            transition: opacity 1s;
            animation: aurora-flow 8s ease-in-out infinite;
        }

        .sky.night .aurora {
            opacity: 1;
        }

        @keyframes aurora-flow {
            0%, 100% { transform: translateX(0) skewX(-5deg); }
            50% { transform: translateX(-33%) skewX(5deg); }
        }

        /* Suelo tecnol√≥gico */
        .ground {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 65%;
            background: linear-gradient(180deg, #0d1f0d 0%, #051205 50%, #020802 100%);
            border-top: 1px solid rgba(0,255,136,0.15);
        }

        .grid-floor {
            position: absolute;
            bottom: 0;
            left: -50%;
            right: -50%;
            height: 60%;
            background-image: 
                linear-gradient(0deg, transparent 24%, rgba(0,255,136,0.03) 25%, rgba(0,255,136,0.03) 26%, transparent 27%),
                linear-gradient(90deg, transparent 24%, rgba(0,255,136,0.03) 25%, rgba(0,255,136,0.03) 26%, transparent 27%);
            background-size: 40px 40px;
            transform: perspective(500px) rotateX(60deg);
            transform-origin: bottom;
        }

        /* UI Layer */
        .ui {
            position: relative;
            z-index: 10;
            height: 100%;
            padding: 8px;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
        }

        .logo {
            font-size: 16px;
            font-weight: 800;
            color: #00ff88;
            text-shadow: 0 0 15px rgba(0,255,136,0.5);
            letter-spacing: 2px;
        }

        .header-icons {
            font-size: 16px;
            color: #00d4ff;
        }

        /* Bot√≥n Tienda */
        .shop-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(0,0,0,0.6);
            border: 1px solid rgba(255,215,0,0.3);
            border-radius: 50%;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.2s;
            z-index: 20;
        }

        .shop-btn:hover {
            background: rgba(255,215,0,0.1);
            border-color: #ffd700;
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(255,215,0,0.3);
        }

        /* PRIMALS - Fila superior */
        .primals-row {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 8px;
        }

        .primal-slot {
            text-align: center;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .primal-slot:hover {
            transform: translateY(-5px) scale(1.1);
        }

        .primal-slot.empty {
            opacity: 0.4;
        }

        .primal-orb {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 26px;
            border: 2px solid;
            position: relative;
            box-shadow: 0 0 25px currentColor;
            overflow: hidden;
        }

        .primal-orb-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 800;
            background: radial-gradient(circle at 30% 30%, var(--orb-color, #666), #1a1a1a);
            color: rgba(255,255,255,0.4);
            z-index: 2;
        }

        .primal-orb::before {
            content: '';
            position: absolute;
            inset: -8px;
            border-radius: 50%;
            border: 2px solid;
            border-top-color: currentColor;
            border-right-color: transparent;
            border-bottom-color: currentColor;
            border-left-color: transparent;
            animation: spin 4s linear infinite;
            opacity: 0.8;
        }

        .primal-orb::after {
            content: '';
            position: absolute;
            inset: -12px;
            border-radius: 50%;
            border: 1px solid;
            opacity: 0.4;
            animation: spin-reverse 6s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @keyframes spin-reverse {
            to { transform: rotate(-360deg); }
        }

        .primal-orb.sealed::before {
            border-top-color: var(--orb-color, #00ff88);
            border-bottom-color: var(--orb-color, #00ff88);
            box-shadow: 0 0 15px var(--orb-color, #00ff88);
        }

        .primal-ember {
            background: radial-gradient(circle at 30% 30%, #ff6b35, #8b0000);
            color: #ff6b35;
            border-color: #ff6b35;
            box-shadow: 0 0 30px #ff6b35, inset 0 0 20px rgba(255,107,53,0.5);
            --orb-color: #ff6b35;
        }

        .primal-tide {
            background: radial-gradient(circle at 30% 30%, #00ffff, #0066aa);
            color: #00ffff;
            border-color: #00ffff;
            box-shadow: 0 0 30px #00ffff, inset 0 0 20px rgba(0,255,255,0.5);
            --orb-color: #00ffff;
        }

        .primal-volt {
            background: radial-gradient(circle at 30% 30%, #ffd700, #ff8c00);
            color: #ffd700;
            border-color: #ffd700;
            box-shadow: 0 0 30px #ffd700, inset 0 0 20px rgba(255,215,0,0.5);
            --orb-color: #ffd700;
        }

        .primal-empty {
            background: radial-gradient(circle at 30% 30%, #444, #222);
            color: #666;
            border-color: #444;
            box-shadow: 0 0 10px rgba(100,100,100,0.2);
            --orb-color: #666;
        }

        .primal-stats-float {
            margin-top: 4px;
            font-size: 10px;
            font-weight: 700;
            display: flex;
            gap: 8px;
            justify-content: center;
            background: rgba(0,0,0,0.6);
            padding: 2px 8px;
            border-radius: 10px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        /* AVATAR CENTRAL */
        .avatar-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            margin-bottom: 8px;
        }

        .avatar-wrap {
            position: relative;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .avatar-wrap:hover {
            transform: scale(1.05);
        }

        .avatar-glow {
            position: absolute;
            inset: -15px;
            background: radial-gradient(circle, rgba(0,255,136,0.2) 0%, transparent 70%);
            border-radius: 50%;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }

        .avatar-main {
            width: 65px;
            height: 65px;
            border-radius: 50%;
            background: linear-gradient(135deg, #1a1a2e, #0f3460);
            border: 3px solid #00ff88;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 30px rgba(0,255,136,0.3);
            position: relative;
            overflow: hidden;
        }

        .avatar-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            font-weight: 800;
            color: rgba(255,255,255,0.4);
            background: linear-gradient(135deg, #2a2a4e, #1f4460);
        }

        .avatar-main.age-baby { border-color: #ff69b4; box-shadow: 0 0 30px rgba(255,105,180,0.3); }
        .avatar-main.age-child { border-color: #ffd700; box-shadow: 0 0 30px rgba(255,215,0,0.3); }
        .avatar-main.age-teen { border-color: #ff8c00; box-shadow: 0 0 30px rgba(255,140,0,0.3); }
        .avatar-main.age-adult { border-color: #00ff88; box-shadow: 0 0 30px rgba(0,255,136,0.3); }
        .avatar-main.age-elderly { border-color: #87ceeb; box-shadow: 0 0 30px rgba(135,206,235,0.3); }

        .avatar-level {
            position: absolute;
            bottom: -5px;
            right: -5px;
            width: 24px;
            height: 24px;
            background: linear-gradient(135deg, #ff6b35, #f7931e);
            border-radius: 50%;
            border: 2px solid #0a0a0f;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: 800;
            color: white;
        }

        .avatar-info-compact {
            text-align: center;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(5px);
            padding: 6px 16px;
            border-radius: 12px;
            border: 1px solid rgba(0,255,136,0.2);
        }

        .avatar-name {
            font-size: 16px;
            font-weight: 800;
            color: white;
            letter-spacing: 0.5px;
        }

        .avatar-meta {
            font-size: 11px;
            color: #8b949e;
            margin-top: 1px;
        }

        .avatar-money {
            font-size: 13px;
            font-weight: 700;
            color: #00ff88;
            margin-top: 3px;
            text-shadow: 0 0 10px rgba(0,255,136,0.3);
        }

        /* STATS COMPACTAS */
        .stats-compact {
            display: flex;
            justify-content: space-between;
            background: rgba(0,0,0,0.5);
            padding: 6px 12px;
            border-radius: 10px;
            margin-bottom: 8px;
            border: 1px solid rgba(0,255,136,0.1);
        }

        .stat-mini {
            text-align: center;
        }

        .stat-mini-icon {
            font-size: 14px;
            margin-bottom: 2px;
        }

        .stat-mini-value {
            font-size: 13px;
            font-weight: 800;
            color: white;
        }

        .stat-mini-label {
            font-size: 8px;
            color: #8b949e;
            text-transform: uppercase;
        }

        /* DIARIO CON COLORES */
        .diary {
            flex: 1;
            background: rgba(10,15,25,0.85);
            border-radius: 12px;
            border: 1px solid rgba(0,255,136,0.15);
            overflow-y: auto;
            padding: 10px;
            margin-bottom: 8px;
        }

        .diary-entry {
            padding: 8px;
            margin-bottom: 6px;
            border-radius: 8px;
            border-left: 3px solid;
            font-size: 12px;
            line-height: 1.4;
            background: rgba(0,0,0,0.3);
            position: relative;
        }

        .entry-year {
            display: inline-block;
            background: rgba(0,255,136,0.2);
            color: #00ff88;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 800;
            margin-right: 6px;
        }

        .entry-text {
            color: #e2e8f0;
        }

        .entry-text b {
            color: white;
            font-weight: 700;
        }

        .entry-tag {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 9px;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 700;
        }

        .entry-primal {
            border-left-color: #ff6b35;
            background: linear-gradient(90deg, rgba(255,107,53,0.1), transparent);
        }

        .entry-work {
            border-left-color: #00d4ff;
            background: linear-gradient(90deg, rgba(0,212,255,0.1), transparent);
        }

        .entry-social {
            border-left-color: #ff00ff;
            background: linear-gradient(90deg, rgba(255,0,255,0.1), transparent);
        }

        .entry-event {
            border-left-color: #00ff88;
            background: linear-gradient(90deg, rgba(0,255,136,0.1), transparent);
        }

        .entry-shop {
            border-left-color: #ffd700;
            background: linear-gradient(90deg, rgba(255,215,0,0.1), transparent);
        }

        .entry-player {
            border-left-color: #00d4ff;
            background: linear-gradient(90deg, rgba(0,212,255,0.1), transparent);
        }

        .tag-good { background: rgba(0,255,136,0.2); color: #00ff88; }
        .tag-bad { background: rgba(255,68,68,0.2); color: #ff4444; }
        .tag-neutral { background: rgba(148,163,184,0.2); color: #94a3b8; }
        .tag-money { background: rgba(0,255,136,0.2); color: #00ff88; }
        .tag-shop { background: rgba(255,215,0,0.2); color: #ffd700; }
        .tag-action { background: rgba(0,212,255,0.2); color: #00d4ff; }
        .tag-evolution { background: rgba(255,107,53,0.2); color: #ff6b35; }

        /* Bot√≥n a√±o */
        .year-section {
            margin-bottom: 8px;
        }

        .btn-year {
            width: 100%;
            background: linear-gradient(90deg, #00ff88, #00d4ff);
            border: none;
            color: #0a0a0f;
            padding: 12px;
            border-radius: 10px;
            font-family: 'Rajdhani', sans-serif;
            font-size: 16px;
            font-weight: 800;
            letter-spacing: 2px;
            cursor: pointer;
            box-shadow: 0 0 20px rgba(0,255,136,0.3);
            transition: all 0.2s;
        }

        .btn-year:hover {
            box-shadow: 0 0 30px rgba(0,255,136,0.5);
            transform: translateY(-2px);
        }

        /* FOOTER */
        .footer {
            display: flex;
            gap: 8px;
        }

        .btn-footer {
            flex: 1;
            background: rgba(0,0,0,0.6);
            border: 1px solid rgba(0,255,136,0.2);
            border-radius: 12px;
            padding: 12px 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-footer:hover {
            background: rgba(0,255,136,0.1);
            border-color: #00ff88;
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(0,255,136,0.2);
        }

        .btn-icon {
            font-size: 24px;
            filter: drop-shadow(0 0 5px currentColor);
        }

        .btn-text {
            font-size: 10px;
            font-weight: 700;
            color: #00ff88;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Paneles */
        .overlay {
            position: absolute;
            inset: 0;
            background: rgba(0,0,0,0.7);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            z-index: 100;
        }

        .overlay.active {
            opacity: 1;
            pointer-events: all;
        }

        .side-panel {
            position: absolute;
            top: 0;
            left: 0;
            width: 85%;
            height: 100%;
            background: linear-gradient(180deg, #0a0f14 0%, #151a24 100%);
            z-index: 101;
            transform: translateX(-100%);
            transition: transform 0.3s ease;
            border-right: 1px solid rgba(0,255,136,0.2);
            overflow-y: auto;
        }

        .side-panel.open {
            transform: translateX(0);
        }

        .panel-header {
            background: linear-gradient(135deg, rgba(0,255,136,0.1), rgba(0,212,255,0.05));
            padding: 15px;
            border-bottom: 1px solid rgba(0,255,136,0.1);
            position: sticky;
            top: 0;
        }

        .panel-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255,255,255,0.1);
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            color: white;
            font-size: 20px;
            cursor: pointer;
        }

        .panel-content {
            padding: 15px;
        }

        .primal-tabs {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .primal-tab {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            border: 2px solid rgba(255,255,255,0.2);
            background: rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 800;
            cursor: pointer;
            transition: all 0.2s;
            overflow: hidden;
            color: rgba(255,255,255,0.3);
        }

        .primal-tab.active {
            border-color: currentColor;
            box-shadow: 0 0 20px currentColor;
        }

        .big-primal {
            text-align: center;
            margin-bottom: 20px;
        }

        .big-orb {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            margin: 0 auto 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            border: 3px solid;
            position: relative;
            box-shadow: 0 0 40px currentColor;
            overflow: hidden;
        }

        .big-orb-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            font-weight: 800;
            background: radial-gradient(circle at 30% 30%, var(--orb-color, #666), #1a1a1a);
            color: rgba(255,255,255,0.3);
            z-index: 2;
        }

        .big-orb::before, .big-orb::after {
            content: '';
            position: absolute;
            border-radius: 50%;
            border: 2px dashed;
            animation: spin 8s linear infinite;
        }

        .big-orb::before {
            inset: -10px;
        }

        .big-orb::after {
            inset: -15px;
            opacity: 0.5;
            animation-duration: 12s;
            animation-direction: reverse;
        }

        .player-big-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 4px solid;
            position: relative;
            box-shadow: 0 0 50px currentColor;
            overflow: hidden;
        }

        .player-big-avatar-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 60px;
            font-weight: 800;
            background: linear-gradient(135deg, #2a2a4e, #1f4460);
            color: rgba(255,255,255,0.3);
        }

        .player-big-avatar.age-baby { border-color: #ff69b4; color: #ff69b4; --orb-color: #ff69b4; }
        .player-big-avatar.age-child { border-color: #ffd700; color: #ffd700; --orb-color: #ffd700; }
        .player-big-avatar.age-teen { border-color: #ff8c00; color: #ff8c00; --orb-color: #ff8c00; }
        .player-big-avatar.age-adult { border-color: #00ff88; color: #00ff88; --orb-color: #00ff88; }
        .player-big-avatar.age-elderly { border-color: #87ceeb; color: #87ceeb; --orb-color: #87ceeb; }

        .stat-detail {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
            padding: 10px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
        }

        .detail-icon {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .detail-bar-bg {
            flex: 1;
            height: 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
            overflow: hidden;
        }

        .detail-bar-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .detail-value {
            font-size: 14px;
            font-weight: 800;
            color: white;
            min-width: 35px;
            text-align: right;
        }

        .action-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-top: 15px;
        }

        .action-btn {
            background: rgba(0,255,136,0.05);
            border: 1px solid rgba(0,255,136,0.2);
            border-radius: 10px;
            padding: 15px 5px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            color: #00ff88;
            transition: all 0.2s;
        }

        .action-btn:hover {
            background: rgba(0,255,136,0.1);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,255,136,0.2);
        }

        .action-icon {
            font-size: 24px;
        }

        .action-name {
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
        }

        .stat-warning {
            animation: flash 1s ease-in-out infinite;
        }

        @keyframes flash {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        ::-webkit-scrollbar {
            width: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(0,255,136,0.3);
            border-radius: 2px;
        }
    </style>
</head>
<body>

<div class="game-container">
    <!-- Fondo -->
    <div class="sky day" id="sky">
        <div class="stars" id="stars"></div>
        <div class="aurora"></div>
        <div class="celestial-body sun" id="sun"></div>
        <div class="celestial-body moon" id="moon" style="display: none;"></div>
    </div>
    <div class="ground">
        <div class="grid-floor"></div>
    </div>

    <!-- Bot√≥n Tienda -->
    <button class="shop-btn" onclick="ui.openShop()" title="Tienda">üõí</button>

    <!-- UI -->
    <div class="ui">
        <!-- Header -->
        <div class="header">
            <div class="logo">‚óâ PRIMALS</div>
            <div class="header-icons">‚ö° ‚óâ</div>
        </div>

        <!-- PRIMALS -->
        <div class="primals-row" id="primalsRow"></div>

        <!-- AVATAR CENTRAL -->
        <div class="avatar-section">
            <div class="avatar-wrap" onclick="ui.openPlayerPanel()">
                <div class="avatar-glow"></div>
                <div class="avatar-main age-adult" id="playerAvatar">
                    <div class="avatar-placeholder" id="avatarPlaceholder">?</div>
                    <div class="avatar-level" id="playerLevel">12</div>
                </div>
            </div>
            <div class="avatar-info-compact">
                <div class="avatar-name" id="playerName">ALEX CHEN</div>
                <div class="avatar-meta" id="playerMeta">24 a√±os ‚Ä¢ Cuidador Primal</div>
                <div class="avatar-money" id="playerMoney">‚óâ 12,400 CR√âDITOS</div>
            </div>
        </div>

        <!-- STATS -->
        <div class="stats-compact">
            <div class="stat-mini">
                <div class="stat-mini-icon">‚ù§Ô∏è</div>
                <div class="stat-mini-value" style="color: #ff4444;" id="statHealth">85</div>
                <div class="stat-mini-label">Salud</div>
            </div>
            <div class="stat-mini">
                <div class="stat-mini-icon">üòä</div>
                <div class="stat-mini-value" style="color: #ffaa00;" id="statHappiness">70</div>
                <div class="stat-mini-label">Felicidad</div>
            </div>
            <div class="stat-mini">
                <div class="stat-mini-icon">üß†</div>
                <div class="stat-mini-value" style="color: #00d4ff;" id="statIntelligence">60</div>
                <div class="stat-mini-label">Inteligencia</div>
            </div>
            <div class="stat-mini">
                <div class="stat-mini-icon">üí™</div>
                <div class="stat-mini-value" style="color: #ff8800;" id="statStrength">45</div>
                <div class="stat-mini-label">Fuerza</div>
            </div>
            <div class="stat-mini">
                <div class="stat-mini-icon">‚ú®</div>
                <div class="stat-mini-value" style="color: #ff66ff;" id="statAppearance">80</div>
                <div class="stat-mini-label">Apariencia</div>
            </div>
        </div>

        <!-- DIARIO -->
        <div class="diary" id="diary"></div>

        <!-- Bot√≥n a√±o -->
        <div class="year-section">
            <button class="btn-year" onclick="game.nextYear()">+1 A√ëO</button>
        </div>

        <!-- FOOTER -->
        <div class="footer">
            <button class="btn-footer" onclick="ui.openTab('life')">
                <span class="btn-icon" style="color: #ff6b6b;">üë§</span>
                <span class="btn-text">Vida</span>
            </button>
            <button class="btn-footer" onclick="ui.openTab('leisure')">
                <span class="btn-icon" style="color: #4ecdc4;">üéÆ</span>
                <span class="btn-text">Ocio</span>
            </button>
            <button class="btn-footer" onclick="ui.openTab('people')">
                <span class="btn-icon" style="color: #ff00ff;">üë•</span>
                <span class="btn-text">Gente</span>
            </button>
            <button class="btn-footer" onclick="ui.openTab('work')">
                <span class="btn-icon" style="color: #ffd700;">üíº</span>
                <span class="btn-text">Trabajo</span>
            </button>
        </div>
    </div>

    <!-- Paneles -->
    <div class="overlay" id="overlay" onclick="ui.closePanel()"></div>
    
    <div class="side-panel" id="primalPanel">
        <div class="panel-header">
            <div style="font-size: 20px; font-weight: 800; color: #00ff88;">‚óâ Primal</div>
            <button class="panel-close" onclick="ui.closePanel()">√ó</button>
            <div class="primal-tabs" id="primalTabs"></div>
        </div>
        <div class="panel-content" id="primalPanelContent"></div>
    </div>

    <div class="side-panel" id="playerPanel">
        <div class="panel-header">
            <div style="font-size: 20px; font-weight: 800; color: #00ff88;">‚óâ Perfil</div>
            <button class="panel-close" onclick="ui.closePanel()">√ó</button>
        </div>
        <div class="panel-content" id="playerPanelContent"></div>
    </div>

    <div class="side-panel" id="shopPanel">
        <div class="panel-header">
            <div style="font-size: 20px; font-weight: 800; color: #ffd700;">‚óâ Tienda</div>
            <button class="panel-close" onclick="ui.closePanel()">√ó</button>
        </div>
        <div class="panel-content" id="shopPanelContent"></div>
    </div>
</div>

<script>
// ==========================================
// CONFIGURACI√ìN
// ==========================================

const CONFIG = {
    MAX_PRIMALS: 3,
    AGE_PHASES: {
        BABY: { min: 0, max: 2, class: 'age-baby', label: 'Beb√©' },
        CHILD: { min: 3, max: 11, class: 'age-child', label: 'Ni√±o' },
        TEEN: { min: 12, max: 17, class: 'age-teen', label: 'Adolescente' },
        ADULT: { min: 18, max: 64, class: 'age-adult', label: 'Adulto' },
        ELDERLY: { min: 65, max: 120, class: 'age-elderly', label: 'Anciano' }
    },
    PRIMAL_TYPES: {
        EMBER: { id: 'ember', color: '#ff6b35', class: 'primal-ember', placeholder: 'P1' },
        TIDE: { id: 'tide', color: '#00ffff', class: 'primal-tide', placeholder: 'P2' },
        VOLT: { id: 'volt', color: '#ffd700', class: 'primal-volt', placeholder: 'P3' }
    }
};

// ==========================================
// GAME STATE
// ==========================================

class GameState {
    constructor() {
        this.player = {
            name: 'Alex Chen',
            age: 24,
            agePhase: 'ADULT',
            level: 12,
            money: 12400,
            job: 'Cuidador Primal',
            stats: {
                health: 85,
                happiness: 70,
                intelligence: 60,
                strength: 45,
                appearance: 80
            },
            history: []
        };
        
        this.primals = [
            {
                id: 1,
                type: 'EMBER',
                name: 'EMBER',
                species: 'Vulpes Ignis',
                phase: 'Fase I',
                sealed: true,
                stats: { health: 80, energy: 60, bond: 92, power: 75 }
            },
            {
                id: 2,
                type: 'TIDE',
                name: 'TIDE',
                species: 'Aqua Lupus',
                phase: 'Fase I',
                sealed: true,
                stats: { health: 90, energy: 75, bond: 85, power: 60 }
            },
            {
                id: 3,
                type: 'VOLT',
                name: 'VOLT',
                species: 'Fulgar Raptor',
                phase: 'Fase I',
                sealed: true,
                stats: { health: 45, energy: 95, bond: 70, power: 88 }
            }
        ];
        
        this.npcs = [];
        this.year = 24;
        this.flags = {};
        
        this.load();
    }

    clampStats() {
        const s = this.player.stats;
        for (let key in s) {
            s[key] = Math.max(0, Math.min(100, s[key]));
        }
        this.primals.forEach(p => {
            if (p) {
                for (let stat in p.stats) {
                    p.stats[stat] = Math.max(0, Math.min(100, p.stats[stat]));
                }
            }
        });
    }

    checkSecondaryEffects() {
        const effects = [];
        
        if (this.player.stats.health < 30) {
            effects.push({ target: 'player', type: 'warning', message: 'Salud cr√≠tica - Necesitas m√©dico' });
            this.player.stats.happiness -= 5;
        }
        if (this.player.stats.happiness < 20) {
            effects.push({ target: 'player', type: 'warning', message: 'Depresi√≥n - Busca ayuda' });
            this.player.stats.health -= 2;
        }
        
        this.primals.forEach((primal, index) => {
            if (!primal) return;
            if (primal.stats.energy < 20) {
                primal.stats.power *= 0.9;
                effects.push({ target: 'primal', index: index, type: 'warning', message: `${primal.name} est√° exhausto` });
            }
            if (primal.stats.health < 30) {
                effects.push({ target: 'primal', index: index, type: 'danger', message: `${primal.name} necesita atenci√≥n m√©dica` });
            }
        });
        
        this.clampStats();
        return effects;
    }

    updateAgePhase() {
        const age = this.player.age;
        for (const [phase, data] of Object.entries(CONFIG.AGE_PHASES)) {
            if (age >= data.min && age <= data.max) {
                this.player.agePhase = phase;
                break;
            }
        }
    }

    addHistory(text, type = 'event', tags = []) {
        this.player.history.unshift({
            year: this.year,
            age: this.player.age,
            text: text,
            type: type,
            tags: tags,
            timestamp: Date.now()
        });
        this.save();
    }

    save() {
        try {
            localStorage.setItem('primalsSave', JSON.stringify({
                player: this.player,
                primals: this.primals,
                year: this.year,
                flags: this.flags
            }));
        } catch (e) {
            console.log('No se pudo guardar');
        }
    }

    load() {
        try {
            const saved = localStorage.getItem('primalsSave');
            if (saved) {
                const data = JSON.parse(saved);
                Object.assign(this.player, data.player);
                this.primals = data.primals;
                this.year = data.year || 24;
                this.flags = data.flags || {};
            }
        } catch (e) {
            console.log('No hay guardado previo');
        }
    }

    reset() {
        localStorage.removeItem('primalsSave');
        location.reload();
    }
}

// ==========================================
// AVATAR SYSTEM
// ==========================================

class AvatarSystem {
    static getPlayerPlaceholder(agePhase) {
        const placeholders = {
            'BABY': 'üë∂',
            'CHILD': 'üßí',
            'TEEN': 'üßë',
            'ADULT': 'üë§',
            'ELDERLY': 'üë¥'
        };
        return placeholders[agePhase] || '?';
    }

    static getPrimalPlaceholder(index, type) {
        if (!type) return `${index + 1}`;
        return CONFIG.PRIMAL_TYPES[type]?.placeholder || `P${index + 1}`;
    }

    static getPrimalColor(type) {
        return CONFIG.PRIMAL_TYPES[type]?.color || '#666';
    }

    static getPrimalClass(type) {
        return CONFIG.PRIMAL_TYPES[type]?.class || 'primal-empty';
    }

    static updatePlayerAvatarClasses(element, agePhase) {
        element.className = 'avatar-main';
        if (CONFIG.AGE_PHASES[agePhase]) {
            element.classList.add(CONFIG.AGE_PHASES[agePhase].class);
        }
    }
}

// ==========================================
// UI CONTROLLER
// ==========================================

class UIController {
    constructor(gameState) {
        this.game = gameState;
        this.currentPrimal = 0;
        this.currentPanel = null;
    }

    render() {
        this.renderPrimals();
        this.renderPlayer();
        this.renderStats();
        this.renderDiary();
    }

    renderPrimals() {
        const container = document.getElementById('primalsRow');
        container.innerHTML = '';
        
        this.game.primals.forEach((primal, index) => {
            const slot = document.createElement('div');
            slot.className = `primal-slot ${!primal ? 'empty' : ''}`;
            slot.onclick = () => primal ? this.openPrimalPanel(index) : null;
            
            const config = primal ? CONFIG.PRIMAL_TYPES[primal.type] : null;
            const color = config ? config.color : '#666';
            const orbClass = config ? config.class : 'primal-empty';
            const placeholder = AvatarSystem.getPrimalPlaceholder(index, primal?.type);
            
            slot.innerHTML = `
                <div class="primal-orb ${orbClass} ${primal?.sealed ? 'sealed' : ''}" style="--orb-color: ${color};">
                    <div class="primal-orb-placeholder">${placeholder}</div>
                </div>
                ${primal ? `
                <div class="primal-stats-float">
                    <span style="color: #ff6b35;">‚ù§Ô∏è${Math.floor(primal.stats.health)}</span>
                    <span style="color: #ffaa00;">‚ö°${Math.floor(primal.stats.energy)}</span>
                </div>
                ` : '<div class="primal-stats-float"><span style="color: #666;">VAC√çO</span></div>'}
            `;
            
            container.appendChild(slot);
        });
    }

    renderPlayer() {
        const p = this.game.player;
        
        const avatarEl = document.getElementById('playerAvatar');
        AvatarSystem.updatePlayerAvatarClasses(avatarEl, p.agePhase);
        
        document.getElementById('avatarPlaceholder').textContent = 
            AvatarSystem.getPlayerPlaceholder(p.agePhase);
        document.getElementById('playerLevel').textContent = p.level;
        document.getElementById('playerName').textContent = p.name.toUpperCase();
        document.getElementById('playerMeta').textContent = 
            `${p.age} a√±os ‚Ä¢ ${p.job || 'Sin profesi√≥n'}`;
        document.getElementById('playerMoney').textContent = `‚óâ ${p.money.toLocaleString()} CR√âDITOS`;
    }

    renderStats() {
        const s = this.game.player.stats;
        document.getElementById('statHealth').textContent = Math.floor(s.health);
        document.getElementById('statHappiness').textContent = Math.floor(s.happiness);
        document.getElementById('statIntelligence').textContent = Math.floor(s.intelligence);
        document.getElementById('statStrength').textContent = Math.floor(s.strength);
        document.getElementById('statAppearance').textContent = Math.floor(s.appearance);
        
        document.getElementById('statHealth').parentElement.classList.toggle('stat-warning', s.health < 30);
        document.getElementById('statHappiness').parentElement.classList.toggle('stat-warning', s.happiness < 20);
    }

    renderDiary() {
        const diary = document.getElementById('diary');
        diary.innerHTML = '';
        
        const entries = this.game.player.history.slice(0, 20);
        if (entries.length === 0) {
            diary.innerHTML = '<div style="text-align: center; color: #666; padding: 20px;">No hay eventos a√∫n</div>';
            return;
        }
        
        entries.forEach(entry => {
            const div = document.createElement('div');
            div.className = `diary-entry entry-${entry.type}`;
            
            const tagClass = entry.tags[0] || 'neutral';
            const tagText = entry.tags[1] || entry.tags[0] || '';
            
            div.innerHTML = `
                <span class="entry-year">+${entry.age}</span>
                <span class="entry-text">${entry.text}</span>
                ${tagText ? `<span class="entry-tag tag-${tagClass}">${tagText}</span>` : ''}
            `;
            diary.appendChild(div);
        });
    }

    openPrimalPanel(index) {
        if (!this.game.primals[index]) {
            alert('Primal no existe');
            return;
        }
        this.currentPrimal = index;
        this.currentPanel = 'primal';
        
        document.getElementById('overlay').classList.add('active');
        document.getElementById('primalPanel').classList.add('open');
        this.renderPrimalPanel();
    }

    openPlayerPanel() {
        this.currentPanel = 'player';
        document.getElementById('overlay').classList.add('active');
        document.getElementById('playerPanel').classList.add('open');
        this.renderPlayerPanel();
    }

    openShop() {
        this.currentPanel = 'shop';
        document.getElementById('overlay').classList.add('active');
        document.getElementById('shopPanel').classList.add('open');
        this.renderShopPanel();
    }

    closePanel() {
        document.getElementById('overlay').classList.remove('active');
        document.querySelectorAll('.side-panel').forEach(p => p.classList.remove('open'));
        this.currentPanel = null;
    }

    // ==========================================
    // RENDER PRIMAL PANEL - COMPLETO
    // ==========================================
    renderPrimalPanel() {
        const primal = this.game.primals[this.currentPrimal];
        if (!primal) return;
        
        const config = CONFIG.PRIMAL_TYPES[primal.type];
        const color = config.color;
        
        // Tabs de selecci√≥n de Primals
        const tabsContainer = document.getElementById('primalTabs');
        tabsContainer.innerHTML = '';
        this.game.primals.forEach((p, i) => {
            if (!p) return;
            const tab = document.createElement('div');
            tab.className = `primal-tab ${i === this.currentPrimal ? 'active' : ''}`;
            tab.style.color = CONFIG.PRIMAL_TYPES[p.type].color;
            tab.style.borderColor = i === this.currentPrimal ? CONFIG.PRIMAL_TYPES[p.type].color : 'rgba(255,255,255,0.2)';
            tab.onclick = (e) => {
                e.stopPropagation();
                this.currentPrimal = i;
                this.renderPrimalPanel();
            };
            tab.textContent = i + 1;
            tabsContainer.appendChild(tab);
        });
        
        // Contenido completo del panel
        document.getElementById('primalPanelContent').innerHTML = `
            <div class="big-primal">
                <div class="big-orb ${config.class}" style="--orb-color: ${color}; color: ${color}; border-color: ${color}; box-shadow: 0 0 40px ${color};">
                    <div class="big-orb-placeholder">${this.currentPrimal + 1}</div>
                </div>
                <div style="font-size: 22px; font-weight: 800; color: ${color};">${primal.name}</div>
                <div style="font-size: 13px; color: #8b949e;">${primal.species} ‚Ä¢ ${primal.phase}</div>
                <div style="font-size: 11px; color: ${primal.sealed ? '#00ff88' : '#666'}; margin-top: 5px;">
                    ${primal.sealed ? '‚óâ SELLADO' : '‚óã SALVAJE'}
                </div>
            </div>
            
            <div class="stat-detail">
                <div class="detail-icon" style="background: linear-gradient(90deg, #ff4444, #ff8800);">‚ù§Ô∏è</div>
                <div class="detail-bar-bg">
                    <div class="detail-bar-fill" style="width: ${primal.stats.health}%; background: linear-gradient(90deg, #ff4444, #ff8800);"></div>
                </div>
                <div class="detail-value">${Math.floor(primal.stats.health)}%</div>
            </div>
            
            <div class="stat-detail">
                <div class="detail-icon" style="background: linear-gradient(90deg, #ffaa00, #ffff00);">‚ö°</div>
                <div class="detail-bar-bg">
                    <div class="detail-bar-fill" style="width: ${primal.stats.energy}%; background: linear-gradient(90deg, #ffaa00, #ffff00);"></div>
                </div>
                <div class="detail-value">${Math.floor(primal.stats.energy)}%</div>
            </div>
            
            <div class="stat-detail">
                <div class="detail-icon" style="background: linear-gradient(90deg, #ff66ff, #ff00ff);">üíú</div>
                <div class="detail-bar-bg">
                    <div class="detail-bar-fill" style="width: ${primal.stats.bond}%; background: linear-gradient(90deg, #ff66ff, #ff00ff);"></div>
                </div>
                <div class="detail-value">${Math.floor(primal.stats.bond)}%</div>
            </div>
            
            <div class="stat-detail">
                <div class="detail-icon" style="background: linear-gradient(90deg, #ff8800, #ff6600);">‚öîÔ∏è</div>
                <div class="detail-bar-bg">
                    <div class="detail-bar-fill" style="width: ${primal.stats.power}%; background: linear-gradient(90deg, #ff8800, #ff6600);"></div>
                </div>
                <div class="detail-value">${Math.floor(primal.stats.power)}%</div>
            </div>
            
            <div class="action-grid">
                <button class="action-btn" onclick="game.doPrimalAction('Entrenar')">
                    <span class="action-icon">üèãÔ∏è</span>
                    <span class="action-name">Entrenar</span>
                </button>
                <button class="action-btn" onclick="game.doPrimalAction('Alimentar')">
                    <span class="action-icon">üçñ</span>
                    <span class="action-name">Alimentar</span>
                </button>
                <button class="action-btn" onclick="game.doPrimalAction('Cazar')">
                    <span class="action-icon">üéØ</span>
                    <span class="action-name">Cazar</span>
                </button>
                <button class="action-btn" onclick="game.doPrimalAction('Descansar')">
                    <span class="action-icon">üò¥</span>
                    <span class="action-name">Descansar</span>
                </button>
                <button class="action-btn" onclick="game.doPrimalAction('Torneo')">
                    <span class="action-icon">üèÜ</span>
                    <span class="action-name">Torneo</span>
                </button>
                <button class="action-btn" onclick="game.doPrimalAction('Evolucionar')">
                    <span class="action-icon">‚ú®</span>
                    <span class="action-name">Evolucionar</span>
                </button>
            </div>
        `;
    }

    renderPlayerPanel() {
        const p = this.game.player;
        const ageClass = CONFIG.AGE_PHASES[p.agePhase].class;
        const color = '#00ff88';
        
        document.getElementById('playerPanelContent').innerHTML = `
            <div style="text-align: center; margin-bottom: 20px;">
                <div class="player-big-avatar ${ageClass}" style="--orb-color: ${color};">
                    <div class="player-big-avatar-placeholder">${AvatarSystem.getPlayerPlaceholder(p.agePhase)}</div>
                </div>
                <div style="font-size: 24px; font-weight: 800; color: white;">${p.name}</div>
                <div style="font-size: 14px; color: #8b949e;">Nivel ${p.level} ‚Ä¢ ${CONFIG.AGE_PHASES[p.agePhase].label}</div>
                <div style="font-size: 16px; color: #00ff88; margin-top: 5px;">‚óâ ${p.money.toLocaleString()} CR√âDITOS</div>
            </div>
            
            <div class="stat-detail">
                <div class="detail-icon" style="background: linear-gradient(90deg, #ff4444, #ff8800);">‚ù§Ô∏è</div>
                <div class="detail-bar-bg">
                    <div class="detail-bar-fill" style="width: ${p.stats.health}%; background: linear-gradient(90deg, #ff4444, #ff8800);"></div>
                </div>
                <div class="detail-value">${Math.floor(p.stats.health)}%</div>
            </div>
            
            <div class="stat-detail">
                <div class="detail-icon" style="background: linear-gradient(90deg, #ffaa00, #ffff00);">üòä</div>
                <div class="detail-bar-bg">
                    <div class="detail-bar-fill" style="width: ${p.stats.happiness}%; background: linear-gradient(90deg, #ffaa00, #ffff00);"></div>
                </div>
                <div class="detail-value">${Math.floor(p.stats.happiness)}%</div>
            </div>
            
            <div class="stat-detail">
                <div class="detail-icon" style="background: linear-gradient(90deg, #00d4ff, #0088ff);">üß†</div>
                <div class="detail-bar-bg">
                    <div class="detail-bar-fill" style="width: ${p.stats.intelligence}%; background: linear-gradient(90deg, #00d4ff, #0088ff);"></div>
                </div>
                <div class="detail-value">${Math.floor(p.stats.intelligence)}%</div>
            </div>
            
            <div class="stat-detail">
                <div class="detail-icon" style="background: linear-gradient(90deg, #ff8800, #ff6600);">üí™</div>
                <div class="detail-bar-bg">
                    <div class="detail-bar-fill" style="width: ${p.stats.strength}%; background: linear-gradient(90deg, #ff8800, #ff6600);"></div>
                </div>
                <div class="detail-value">${Math.floor(p.stats.strength)}%</div>
            </div>
            
            <div class="stat-detail">
                <div class="detail-icon" style="background: linear-gradient(90deg, #ff66ff, #ff00ff);">‚ú®</div>
                <div class="detail-bar-bg">
                    <div class="detail-bar-fill" style="width: ${p.stats.appearance}%; background: linear-gradient(90deg, #ff66ff, #ff00ff);"></div>
                </div>
                <div class="detail-value">${Math.floor(p.stats.appearance)}%</div>
            </div>
            
            <div class="action-grid">
                <button class="action-btn" onclick="game.doPlayerAction('Estudiar')">
                    <span class="action-icon">üìö</span>
                    <span class="action-name">Estudiar</span>
                </button>
                <button class="action-btn" onclick="game.doPlayerAction('Entrenar')">
                    <span class="action-icon">üí™</span>
                    <span class="action-name">Entrenar</span>
                </button>
                <button class="action-btn" onclick="game.doPlayerAction('Hobby')">
                    <span class="action-icon">üé®</span>
                    <span class="action-name">Hobby</span>
                </button>
                <button class="action-btn" onclick="game.doPlayerAction('Cambiar')">
                    <span class="action-icon">‚úÇÔ∏è</span>
                    <span class="action-name">Look</span>
                </button>
                <button class="action-btn" onclick="game.doPlayerAction('M√©dico')">
                    <span class="action-icon">üè•</span>
                    <span class="action-name">M√©dico</span>
                </button>
                <button class="action-btn" onclick="game.doPlayerAction('Meditar')">
                    <span class="action-icon">üßò</span>
                    <span class="action-name">Meditar</span>
                </button>
            </div>
            
            <button class="btn-year" style="margin-top: 20px; background: linear-gradient(90deg, #ff4444, #ff8800);" onclick="if(confirm('¬øReiniciar partida?')) game.state.reset()">
                REINICIAR PARTIDA
            </button>
        `;
    }

    renderShopPanel() {
        document.getElementById('shopPanelContent').innerHTML = `
            <div style="text-align: center; margin-bottom: 20px;">
                <div style="font-size: 48px; margin-bottom: 10px;">üõí</div>
                <div style="font-size: 18px; color: #ffd700;">Mercado de Primals</div>
            </div>
            
            <div class="action-grid" style="grid-template-columns: 1fr;">
                <button class="action-btn" style="flex-direction: row; justify-content: space-between; padding: 15px;" onclick="game.buyItem('Comida Premium', 500)">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 28px;">üçñ</span>
                        <div style="text-align: left;">
                            <div style="font-size: 14px; font-weight: 700; color: white;">Comida Premium</div>
                            <div style="font-size: 11px; color: #8b949e;">+20 Energ√≠a Primal</div>
                        </div>
                    </div>
                    <div style="color: #ffd700; font-weight: 800;">‚óâ500</div>
                </button>
                
                <button class="action-btn" style="flex-direction: row; justify-content: space-between; padding: 15px;" onclick="game.buyItem('Kit M√©dico', 1200)">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 28px;">üíä</span>
                        <div style="text-align: left;">
                            <div style="font-size: 14px; font-weight: 700; color: white;">Kit M√©dico</div>
                            <div style="font-size: 11px; color: #8b949e;">+30 Salud Primal</div>
                        </div>
                    </div>
                    <div style="color: #ffd700; font-weight: 800;">‚óâ1200</div>
                </button>
                
                <button class="action-btn" style="flex-direction: row; justify-content: space-between; padding: 15px;" onclick="game.buyItem('Potenciador', 2500)">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 28px;">‚öóÔ∏è</span>
                        <div style="text-align: left;">
                            <div style="font-size: 14px; font-weight: 700; color: white;">Potenciador</div>
                            <div style="font-size: 11px; color: #8b949e;">+10 Poder permanente</div>
                        </div>
                    </div>
                    <div style="color: #ffd700; font-weight: 800;">‚óâ2500</div>
                </button>
                
                <button class="action-btn" style="flex-direction: row; justify-content: space-between; padding: 15px;" onclick="game.buyItem('Mochila Expansi√≥n', 3000)">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 28px;">üéí</span>
                        <div style="text-align: left;">
                            <div style="font-size: 14px; font-weight: 700; color: white;">Mochila Expansi√≥n</div>
                            <div style="font-size: 11px; color: #8b949e;">+1 Slot √≠tems</div>
                        </div>
                    </div>
                    <div style="color: #ffd700; font-weight: 800;">‚óâ3000</div>
                </button>
                
                <button class="action-btn" style="flex-direction: row; justify-content: space-between; padding: 15px;" onclick="game.buyItem('Mejora Establo', 5000)">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 28px;">üè†</span>
                        <div style="text-align: left;">
                            <div style="font-size: 14px; font-weight: 700; color: white;">Mejora Establo</div>
                            <div style="font-size: 11px; color: #8b949e;">Regeneraci√≥n +50%</div>
                        </div>
                    </div>
                    <div style="color: #ffd700; font-weight: 800;">‚óâ5000</div>
                </button>
                
                <button class="action-btn" style="flex-direction: row; justify-content: space-between; padding: 15px;" onclick="game.buyItem('Tri√°ngulo Raro', 10000)">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 28px;">üîÆ</span>
                        <div style="text-align: left;">
                            <div style="font-size: 14px; font-weight: 700; color: white;">Tri√°ngulo Raro</div>
                            <div style="font-size: 11px; color: #8b949e;">Para captura especial</div>
                        </div>
                    </div>
                    <div style="color: #ffd700; font-weight: 800;">‚óâ10000</div>
                </button>
            </div>
        `;
    }

    openTab(tab) {
        console.log('Abrir tab:', tab);
    }
}

// ==========================================
// GAME ENGINE
// ==========================================

class GameEngine {
    constructor() {
        this.state = new GameState();
        this.ui = new UIController(this.state);
    }

    init() {
        this.ui.render();
        this.setupBackground();
        this.addInitialHistory();
    }

    setupBackground() {
        const updateSky = () => {
            const hour = new Date().getHours();
            const sky = document.getElementById('sky');
            const sun = document.getElementById('sun');
            const moon = document.getElementById('moon');
            
            sky.className = 'sky';
            
            if (hour >= 6 && hour < 18) {
                sky.classList.add('day');
                sun.style.display = 'block';
                moon.style.display = 'none';
            } else if (hour >= 18 && hour < 21) {
                sky.classList.add('sunset');
                sun.style.display = 'block';
                moon.style.display = 'none';
            } else {
                sky.classList.add('night');
                sun.style.display = 'none';
                moon.style.display = 'block';
            }
        };

        const starsContainer = document.getElementById('stars');
        for (let i = 0; i < 50; i++) {
            const star = document.createElement('div');
            star.className = 'star';
            star.style.left = Math.random() * 100 + '%';
            star.style.top = Math.random() * 100 + '%';
            star.style.animationDelay = Math.random() * 3 + 's';
            starsContainer.appendChild(star);
        }

        updateSky();
        setInterval(updateSky, 60000);
    }

    addInitialHistory() {
        if (this.state.player.history.length === 0) {
            this.state.addHistory('<b>Ember</b> gan√≥ Torneo Regional vs Canis Noctis', 'primal', ['money', '+340‚óâ']);
            this.state.addHistory('Jefe ofrece ascenso a <b>Entrenador Regional</b>', 'work', ['neutral', 'Decidir']);
            this.state.addHistory('<b>Tide</b> encontr√≥ Cueva de Cristales', 'primal', ['good', '+15 V√≠nculo']);
            this.state.addHistory('Conociste a <b>Mara Voss</b> en Mercado', 'social', ['good', 'Amiga']);
            this.state.addHistory('<b>Volt</b> a semifinales, luego colaps√≥', 'event', ['bad', 'Trauma']);
        }
    }

    randomEvent() {
        const events = [
            { text: 'Encuentras dinero en la calle', type: 'event', tags: ['good', '+100‚óâ'], effect: () => { this.state.player.money += 100; this.state.player.stats.happiness += 5; } },
            { text: 'Te enfermas de gripe', type: 'health', tags: ['bad', '-Salud'], effect: () => { this.state.player.stats.health -= 15; this.state.player.stats.happiness -= 10; } },
            { text: 'Recibes una herencia inesperada', type: 'event', tags: ['good', '+5000‚óâ'], effect: () => { this.state.player.money += 5000; } },
            { text: 'Pelea con un amigo', type: 'social', tags: ['bad', '-Amistad'], effect: () => { this.state.player.stats.happiness -= 15; } },
            { text: 'D√≠a perfecto', type: 'event', tags: ['good', '+Felicidad'], effect: () => { this.state.player.stats.happiness += 20; } },
            { text: 'Accidente menor', type: 'event', tags: ['bad', '-Salud'], effect: () => { this.state.player.stats.health -= 10; } },
            { text: 'Oportunidad de negocio', type: 'work', tags: ['neutral', 'Decisi√≥n'], effect: () => { this.state.player.stats.intelligence += 3; } },
            { text: 'Descubres un objeto raro', type: 'event', tags: ['good', 'Tesoro'], effect: () => { this.state.player.money += 300; this.state.player.stats.happiness += 5; } }
        ];
        
        if (Math.random() < 0.4) {
            const event = events[Math.floor(Math.random() * events.length)];
            event.effect();
            this.state.addHistory(event.text, event.type, event.tags);
            return true;
        }
        return false;
    }

    nextYear() {
        this.state.year++;
        this.state.player.age++;
        this.state.updateAgePhase();
        
        if (this.state.player.age > 40) {
            this.state.player.stats.health -= 1;
            this.state.player.stats.strength -= 0.5;
        }
        if (this.state.player.age > 60) {
            this.state.player.stats.health -= 2;
        }
        
        this.state.primals.forEach(primal => {
            if (primal) {
                primal.stats.energy = Math.min(100, primal.stats.energy + 5);
                primal.stats.health = Math.min(100, primal.stats.health + 2);
            }
        });
        
        const hadEvent = this.randomEvent();
        
        if (!hadEvent) {
            this.state.addHistory(`Has cumplido <b>${this.state.player.age} a√±os</b>`, 'event', ['neutral', 'Edad']);
        }
        
        const effects = this.state.checkSecondaryEffects();
        effects.forEach(effect => {
            if (effect.type === 'warning' || effect.type === 'danger') {
                this.state.addHistory(`‚ö†Ô∏è ${effect.message}`, effect.target === 'player' ? 'event' : 'primal', ['bad', 'Alerta']);
            }
        });
        
        this.state.clampStats();
        this.state.save();
        this.ui.render();
    }

    doPlayerAction(action) {
        const p = this.state.player;
        
        switch(action) {
            case 'Estudiar':
                p.stats.intelligence += 8;
                p.stats.happiness -= 3;
                p.stats.energy = (p.stats.energy || 100) - 5;
                this.state.addHistory('Estudiaste intensamente', 'player', ['action', '+INT']);
                break;
            case 'Entrenar':
                p.stats.strength += 8;
                p.stats.health -= 3;
                p.stats.energy = (p.stats.energy || 100) - 10;
                this.state.addHistory('Entrenamiento f√≠sico completado', 'player', ['action', '+FUE']);
                break;
            case 'Hobby':
                p.stats.happiness += 10;
                p.stats.energy = (p.stats.energy || 100) - 5;
                this.state.addHistory('Disfrutaste de tu hobby favorito', 'player', ['good', '+FEL']);
                break;
            case 'Cambiar':
                p.stats.appearance += 8;
                p.stats.money -= 200;
                this.state.addHistory('Cambio de look realizado', 'player', ['action', '+APR']);
                break;
            case 'M√©dico':
                p.stats.health += 20;
                p.stats.money -= 500;
                this.state.addHistory('Visita al m√©dico', 'player', ['good', '+SAL']);
                break;
            case 'Meditar':
                p.stats.happiness += 5;
                p.stats.intelligence += 3;
                p.stats.health += 2;
                this.state.addHistory('Meditaci√≥n y mindfulness', 'player', ['good', 'Equilibrio']);
                break;
        }
        
        this.state.clampStats();
        this.state.save();
        this.ui.closePanel();
        this.ui.render();
    }

    doPrimalAction(action) {
        const primal = this.state.primals[this.ui.currentPrimal];
        if (!primal) return;
        
        let evolved = false;
        
        switch(action) {
            case 'Entrenar':
                primal.stats.power += 8;
                primal.stats.energy -= 15;
                primal.stats.bond += 2;
                
                if (primal.stats.power >= 100 && primal.phase === 'Fase I') {
                    primal.phase = 'Fase II';
                    evolved = true;
                } else if (primal.stats.power >= 200 && primal.phase === 'Fase II') {
                    primal.phase = 'Fase III';
                    evolved = true;
                }
                break;
            case 'Alimentar':
                primal.stats.health += 15;
                primal.stats.energy += 10;
                primal.stats.bond += 5;
                this.state.player.money -= 50;
                break;
            case 'Cazar':
                primal.stats.power += 5;
                primal.stats.energy -= 20;
                primal.stats.health -= 5;
                const loot = Math.floor(Math.random() * 200) + 50;
                this.state.player.money += loot;
                this.state.addHistory(`${primal.name} caz√≥ y encontr√≥ ‚óâ${loot}`, 'primal', ['money', `+${loot}‚óâ`]);
                break;
            case 'Descansar':
                primal.stats.energy += 30;
                primal.stats.health += 5;
                break;
            case 'Torneo':
                primal.stats.energy -= 25;
                primal.stats.bond += 3;
                const won = Math.random() > 0.5;
                if (won) {
                    const prize = Math.floor(Math.random() * 500) + 100;
                    this.state.player.money += prize;
                    primal.stats.power += 5;
                    this.state.addHistory(`${primal.name} gan√≥ torneo`, 'primal', ['good', `+${prize}‚óâ`]);
                } else {
                    primal.stats.health -= 10;
                    this.state.addHistory(`${primal.name} perdi√≥ en torneo`, 'primal', ['bad', 'Derrota']);
                }
                break;
            case 'Evolucionar':
                if (primal.phase === 'Fase I' && primal.stats.power >= 80) {
                    primal.phase = 'Fase II';
                    evolved = true;
                } else if (primal.phase === 'Fase II' && primal.stats.power >= 180) {
                    primal.phase = 'Fase III';
                    evolved = true;
                }
                break;
        }
        
        if (evolved) {
            this.state.addHistory(`<b>${primal.name}</b> evolucion√≥ a ${primal.phase}`, 'primal', ['evolution', '¬°Evoluci√≥n!']);
        }
        
        this.state.clampStats();
        this.state.save();
        this.ui.renderPrimalPanel();
        this.ui.render();
    }

    buyItem(name, price) {
        if (this.state.player.money >= price) {
            this.state.player.money -= price;
            
            switch(name) {
                case 'Comida Premium':
                    this.state.primals.forEach(p => { if(p) p.stats.energy += 20; });
                    break;
                case 'Kit M√©dico':
                    this.state.primals.forEach(p => { if(p) p.stats.health += 30; });
                    break;
                case 'Potenciador':
                    this.state.primals.forEach(p => { if(p) p.stats.power += 10; });
                    break;
            }
            
            this.state.addHistory(`Compraste <b>${name}</b>`, 'shop', ['shop', `-‚óâ${price}`]);
            this.state.clampStats();
            this.state.save();
            this.ui.render();
            this.ui.renderShopPanel();
        } else {
            alert('No tienes suficientes cr√©ditos');
        }
    }
}

// ==========================================
// INICIALIZACI√ìN
// ==========================================

const game = new GameEngine();
const ui = game.ui;

window.game = game;
window.ui = ui;

window.onload = () => game.init();
</script>

</body>
</html>